<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Digest å†…å®¹ç®¡ç†</title>
  <style>
    :root {
      --bg: #f8f9fa;
      --panel: #ffffff;
      --text: #212529;
      --muted: #6c757d;
      --border: #dee2e6;
      --accent: #0d6efd;
      --accent-bg: #e7f1ff;
      --danger: #dc3545;
      --success: #198754;
      --warning: #ffc107;
      --shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    
    [data-theme="dark"] {
      --bg: #1a1d21;
      --panel: #212529;
      --text: #e9ecef;
      --muted: #adb5bd;
      --border: #343a40;
      --accent: #4dabf7;
      --accent-bg: #1c3d5c;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      font-size: 15px;
    }
    
    .header {
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo { font-size: 1.25rem; font-weight: 600; }
    .logo span {
      background: var(--accent);
      color: white;
      font-size: 0.65rem;
      padding: 2px 8px;
      border-radius: 4px;
      margin-left: 8px;
    }
    
    .header-actions { display: flex; gap: 12px; align-items: center; }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:hover { opacity: 0.9; }
    .btn-secondary { background: var(--bg); color: var(--muted); border: 1px solid var(--border); }
    .btn-secondary:hover { color: var(--text); border-color: var(--accent); }
    .btn-danger { background: var(--danger); color: white; }
    .btn-danger:hover { opacity: 0.9; }
    .btn-warning { background: var(--warning); color: #000; }
    
    .main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 24px;
    }
    
    @media (max-width: 1024px) {
      .main { grid-template-columns: 1fr; }
    }
    
    .card {
      background: var(--panel);
      border-radius: 12px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-body { padding: 20px; }
    
    .tabs {
      display: flex;
      gap: 4px;
      padding: 4px;
      background: var(--bg);
      border-radius: 10px;
      margin-bottom: 20px;
    }
    
    .tab {
      flex: 1;
      padding: 10px;
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 0.9rem;
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
    }
    
    .tab.active { background: var(--panel); color: var(--text); box-shadow: var(--shadow); }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* æ–‡ç« é¡¹ */
    .article-item {
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.2s;
      position: relative;
    }
    
    .article-item:hover { border-color: var(--accent); }
    
    .article-item.deleted {
      opacity: 0.5;
      border-color: var(--danger);
      background: rgba(220, 53, 69, 0.05);
    }
    
    .article-item.deleted::after {
      content: "å·²æ ‡è®°åˆ é™¤";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--danger);
      color: white;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .article-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .article-num {
      font-size: 0.8rem;
      color: var(--accent);
      font-weight: 600;
      background: var(--accent-bg);
      padding: 2px 10px;
      border-radius: 20px;
    }
    
    .article-actions { display: flex; gap: 6px; }
    
    .btn-icon {
      width: 32px;
      height: 32px;
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      transition: all 0.2s;
    }
    
    .btn-icon:hover { border-color: var(--accent); color: var(--accent); }
    .btn-icon.delete:hover { border-color: var(--danger); color: var(--danger); }
    .btn-icon.restore { color: var(--success); }
    .btn-icon.restore:hover { border-color: var(--success); }
    
    /* åˆ é™¤æ§åˆ¶åŒº */
    .delete-control {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
    }
    
    .delete-mode-btn {
      padding: 8px 16px;
      border: 2px solid var(--border);
      background: var(--panel);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    .delete-mode-btn.active {
      border-color: var(--danger);
      color: var(--danger);
      font-weight: 600;
    }
    
    /* å›æ”¶ç«™ */
    .trash-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px dashed var(--border);
    }
    
    .trash-title {
      font-size: 0.9rem;
      color: var(--danger);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* è¡¨å• */
    .form-group { margin-bottom: 12px; }
    .form-label { display: block; font-size: 0.8rem; color: var(--muted); margin-bottom: 4px; }
    .form-input, .form-textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--panel);
      color: var(--text);
      font-size: 0.9rem;
    }
    .form-textarea { min-height: 60px; resize: vertical; }
    
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    
    /* ç»Ÿè®¡ */
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .stat-box { text-align: center; padding: 12px; background: var(--bg); border-radius: 8px; }
    .stat-num { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
    .stat-label { font-size: 0.75rem; color: var(--muted); }
    .stat-num.deleted { color: var(--danger); }
    
    /* ä»£ç åŒº */
    .code-box {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 12px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.75rem;
      max-height: 200px;
      overflow: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    .empty-text { color: #6c757d; font-style: italic; }
    
    /* æç¤º */
    .alert {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 0.9rem;
    }
    .alert-info { background: var(--accent-bg); color: var(--accent); }
    .alert-warning { background: #fff3cd; color: #856404; }
    
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">ğŸ“ Daily Digest <span>ç®¡ç†åå°</span></div>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="toggleDeleteMode()" id="deleteModeBtn">
        ğŸ—‘ï¸ åˆ é™¤æ¨¡å¼: å…³
      </button>
      <button class="btn btn-primary" onclick="generateCode()">ğŸ”„ ç”Ÿæˆä»£ç </button>
      <button class="btn btn-secondary" onclick="copyCode()" id="copyBtn" disabled>ğŸ“‹ å¤åˆ¶</button>
    </div>
  </header>

  <main class="main">
    <!-- å·¦ä¾§ï¼šå†…å®¹åˆ—è¡¨ -->
    <div class="editor">
      <div class="card">
        <div class="card-header">
          <span>ğŸ“… æ—¥æœŸè®¾ç½®</span>
          <button class="btn btn-secondary" onclick="refreshDate()" style="padding: 6px 12px; font-size: 0.85rem;">ğŸ”„ åˆ·æ–°æ—¥æœŸ</button>
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">ä¸­æ–‡æ—¥æœŸ</label>
              <input type="text" class="form-input" id="date-zh" placeholder="è‡ªåŠ¨è·å–" readonly style="background: var(--bg); color: var(--muted);">
            </div>
            <div class="form-group">
              <label class="form-label">è‹±æ–‡æ—¥æœŸ</label>
              <input type="text" class="form-input" id="date-en" placeholder="è‡ªåŠ¨è·å–" readonly style="background: var(--bg); color: var(--muted);">
            </div>
          </div>
          <p style="font-size: 0.8rem; color: var(--muted); margin-top: 8px;">
            ğŸ’¡ è‡ªåŠ¨è·å–å½“å‰æ—¥æœŸï¼Œç‚¹å‡»åˆ·æ–°å¯æ›´æ–°
          </p>
        </div>
      </div>

      <!-- æ ‡ç­¾é¡µ -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('rss', this)">ğŸ“¡ RSS (<span id="tab-count-rss">0</span>)</button>
        <button class="tab" onclick="switchTab('ai', this)">ğŸ¤– AI (<span id="tab-count-ai">0</span>)</button>
        <button class="tab" onclick="switchTab('thoughts', this)">ğŸ’­ æ€è€ƒ (<span id="tab-count-thoughts">0</span>)</button>
        <button class="tab" onclick="switchTab('rec', this)">ğŸ“Œ æ¨è (<span id="tab-count-rec">0</span>)</button>
      </div>

      <!-- åˆ é™¤æ¨¡å¼æç¤º -->
      <div class="alert alert-info hidden" id="deleteModeAlert">
        ğŸ—‘ï¸ <strong>åˆ é™¤æ¨¡å¼å·²å¼€å¯</strong> - ç‚¹å‡»æ–‡ç« å³ä¸Šè§’çš„ ğŸ—‘ï¸ æ ‡è®°åˆ é™¤ï¼Œç‚¹å‡» â†©ï¸ æ’¤é”€åˆ é™¤
      </div>

      <!-- RSS -->
      <div class="tab-content active" id="tab-rss">
        <div class="card">
          <div class="card-header">
            <span>ğŸ“¡ RSSæ–‡ç« </span>
            <button class="btn btn-secondary" onclick="addItem('rss')" style="padding: 6px 12px; font-size: 0.85rem;">+ æ·»åŠ </button>
          </div>
          <div class="card-body" id="list-rss"></div>
        </div>
      </div>

      <!-- AI -->
      <div class="tab-content" id="tab-ai">
        <div class="card">
          <div class="card-header">
            <span>ğŸ¤– AIæ–°é—»</span>
            <button class="btn btn-secondary" onclick="addItem('ai')" style="padding: 6px 12px; font-size: 0.85rem;">+ æ·»åŠ </button>
          </div>
          <div class="card-body" id="list-ai"></div>
        </div>
      </div>

      <!-- æ€è€ƒ -->
      <div class="tab-content" id="tab-thoughts">
        <div class="card">
          <div class="card-header">
            <span>ğŸ’­ ä¸ªäººæ€è€ƒ</span>
            <button class="btn btn-secondary" onclick="addItem('thoughts')" style="padding: 6px 12px; font-size: 0.85rem;">+ æ·»åŠ </button>
          </div>
          <div class="card-body" id="list-thoughts"></div>
        </div>
      </div>

      <!-- æ¨è -->
      <div class="tab-content" id="tab-rec">
        <div class="card">
          <div class="card-header">
            <span>ğŸ“Œ ä¸ªäººæ¨è</span>
            <button class="btn btn-secondary" onclick="addItem('rec')" style="padding: 6px 12px; font-size: 0.85rem;">+ æ·»åŠ </button>
          </div>
          <div class="card-body" id="list-rec"></div>
        </div>
      </div>
    </div>

    <!-- å³ä¾§ï¼šç»Ÿè®¡ä¸å¯¼å‡º -->
    <aside class="sidebar">
      <!-- ç»Ÿè®¡ -->
      <div class="card">
        <div class="card-header">ğŸ“Š ç»Ÿè®¡</div>
        <div class="card-body">
          <div class="stat-grid">
            <div class="stat-box">
              <div class="stat-num" id="stat-rss">0</div>
              <div class="stat-label">RSS</div>
            </div>
            <div class="stat-box">
              <div class="stat-num" id="stat-ai">0</div>
              <div class="stat-label">AI</div>
            </div>
            <div class="stat-box">
              <div class="stat-num" id="stat-thoughts">0</div>
              <div class="stat-label">æ€è€ƒ</div>
            </div>
            <div class="stat-box">
              <div class="stat-num" id="stat-rec">0</div>
              <div class="stat-label">æ¨è</div>
            </div>
          </div>
          
          <div class="stat-grid" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
            <div class="stat-box">
              <div class="stat-num" id="stat-total">0</div>
              <div class="stat-label">æ€»è®¡</div>
            </div>
            <div class="stat-box">
              <div class="stat-num deleted" id="stat-deleted">0</div>
              <div class="stat-label">å¾…åˆ é™¤</div>
            </div>
          </div>
        </div>
      </div>

      <!-- å¯¼å‡º -->
      <div class="card">
        <div class="card-header">ğŸ“¤ å¯¼å‡ºä»£ç </div>
        <div class="card-body">
          <div class="alert alert-warning" style="margin-bottom: 12px; font-size: 0.85rem;">
            ç”Ÿæˆä»£ç æ—¶ä¼šè‡ªåŠ¨æ’é™¤"å¾…åˆ é™¤"çš„æ–‡ç« ï¼Œç¼–å·é‡æ–°è®¡ç®—
          </div>
          <div class="code-box" id="codeOutput"><span class="empty-text">// ç‚¹å‡»ç”ŸæˆæŒ‰é’®...</span></div>
        </div>
      </div>

      <!-- æ“ä½œè¯´æ˜ -->
      <div class="card">
        <div class="card-header">ğŸ’¡ ä½¿ç”¨è¯´æ˜</div>
        <div class="card-body" style="font-size: 0.85rem; line-height: 1.7;">
          <p><strong>åˆ é™¤æ–‡ç« ï¼š</strong></p>
          <ol style="padding-left: 18px; margin-bottom: 12px;">
            <li>ç‚¹å‡»"åˆ é™¤æ¨¡å¼: å…³"å¼€å¯åˆ é™¤æ¨¡å¼</li>
            <li>ç‚¹å‡»æ–‡ç« å³ä¸Šè§’çš„ ğŸ—‘ï¸ æ ‡è®°åˆ é™¤</li>
            <li>ç‚¹å‡» â†©ï¸ å¯ä»¥æ’¤é”€åˆ é™¤</li>
            <li>ç‚¹å‡»"ç”Ÿæˆä»£ç "å¯¼å‡ºï¼ˆè‡ªåŠ¨æ’é™¤åˆ é™¤é¡¹ï¼‰</li>
          </ol>
          <p style="color: var(--muted);">è¢«æ ‡è®°åˆ é™¤çš„æ–‡ç« ä¸ä¼šçœŸæ­£æ¶ˆå¤±ï¼Œéšæ—¶å¯ä»¥æ’¤é”€ã€‚</p>
        </div>
      </div>
    </aside>
  </main>

  <script>
    // æ•°æ®ç»“æ„ï¼šæ¯ä¸ªæ–‡ç« æœ‰ id, data, deleted å­—æ®µ
    let articles = {
      rss: [],
      ai: [],
      thoughts: [],
      rec: []
    };
    
    let dates = { zh: '', en: '' };
    let deleteMode = false;
    let generatedCode = '';

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      if (!dates.zh || !dates.en) {
        refreshDate();  // é¦–æ¬¡æ‰“å¼€è‡ªåŠ¨ç”Ÿæˆæ—¥æœŸ
      }
      renderAll();
    });

    // è‡ªåŠ¨ç”Ÿæˆæ—¥æœŸ
    function refreshDate() {
      const now = new Date();
      
      // ä¸­æ–‡æ ¼å¼ï¼š2026å¹´2æœˆ16æ—¥
      const zhYear = now.getFullYear();
      const zhMonth = now.getMonth() + 1;
      const zhDay = now.getDate();
      dates.zh = `${zhYear}å¹´${zhMonth}æœˆ${zhDay}æ—¥`;
      
      // è‹±æ–‡æ ¼å¼ï¼šFebruary 16, 2026
      const enOptions = { year: 'numeric', month: 'long', day: 'numeric' };
      dates.en = now.toLocaleDateString('en-US', enOptions);
      
      // æ›´æ–°æ˜¾ç¤º
      document.getElementById('date-zh').value = dates.zh;
      document.getElementById('date-en').value = dates.en;
      
      saveData();
    }

    // åˆ‡æ¢åˆ é™¤æ¨¡å¼
    function toggleDeleteMode() {
      deleteMode = !deleteMode;
      const btn = document.getElementById('deleteModeBtn');
      const alert = document.getElementById('deleteModeAlert');
      
      if (deleteMode) {
        btn.textContent = 'ğŸ—‘ï¸ åˆ é™¤æ¨¡å¼: å¼€';
        btn.classList.add('btn-danger');
        btn.classList.remove('btn-secondary');
        alert.classList.remove('hidden');
      } else {
        btn.textContent = 'ğŸ—‘ï¸ åˆ é™¤æ¨¡å¼: å…³';
        btn.classList.remove('btn-danger');
        btn.classList.add('btn-secondary');
        alert.classList.add('hidden');
      }
      
      renderAll();
    }

    // åˆ‡æ¢æ ‡ç­¾
    function switchTab(tab, btn) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById('tab-' + tab).classList.add('active');
    }

    // æ·»åŠ æ–‡ç« 
    function addItem(type, data, deleted = false) {
      const id = Date.now() + Math.random();
      articles[type].push({ id, data: data || {}, deleted });
      saveData();
      renderAll();
    }

    // æ ‡è®°åˆ é™¤/æ’¤é”€
    function toggleDelete(type, id) {
      const item = articles[type].find(a => a.id === id);
      if (item) {
        item.deleted = !item.deleted;
        saveData();
        renderAll();
      }
    }

    // å½»åº•åˆ é™¤ï¼ˆä»æ•°ç»„ç§»é™¤ï¼‰
    function permanentDelete(type, id) {
      if (!confirm('ç¡®å®šå½»åº•åˆ é™¤ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) return;
      articles[type] = articles[type].filter(a => a.id !== id);
      saveData();
      renderAll();
    }

    // ä¸Šç§»
    function moveUp(type, id) {
      const idx = articles[type].findIndex(a => a.id === id);
      if (idx > 0) {
        [articles[type][idx], articles[type][idx-1]] = [articles[type][idx-1], articles[type][idx]];
        saveData();
        renderAll();
      }
    }

    // ä¸‹ç§»
    function moveDown(type, id) {
      const idx = articles[type].findIndex(a => a.id === id);
      if (idx < articles[type].length - 1) {
        [articles[type][idx], articles[type][idx+1]] = [articles[type][idx+1], articles[type][idx]];
        saveData();
        renderAll();
      }
    }

    // æ›´æ–°æ–‡ç« æ•°æ®
    function updateItem(type, id, field, value) {
      const item = articles[type].find(a => a.id === id);
      if (item) {
        item.data[field] = value;
        saveData();
      }
    }

    // æ¸²æŸ“æ‰€æœ‰
    function renderAll() {
      dates.zh = document.getElementById('date-zh').value;
      dates.en = document.getElementById('date-en').value;
      
      ['rss', 'ai', 'thoughts', 'rec'].forEach(type => renderList(type));
      updateStats();
    }

    // æ¸²æŸ“åˆ—è¡¨
    function renderList(type) {
      const container = document.getElementById('list-' + type);
      const list = articles[type];
      
      // æ›´æ–°æ ‡ç­¾é¡µè®¡æ•°
      const visibleCount = list.filter(a => !a.deleted).length;
      const deletedCount = list.filter(a => a.deleted).length;
      document.getElementById('tab-count-' + type).textContent = visibleCount;
      
      if (list.length === 0) {
        container.innerHTML = '<p style="color: var(--muted); text-align: center; padding: 40px;">æš‚æ— å†…å®¹ï¼Œç‚¹å‡»"æ·»åŠ "æŒ‰é’®</p>';
        return;
      }
      
      let html = '';
      let visibleIndex = 0;
      
      list.forEach((item, index) => {
        const isDeleted = item.deleted;
        if (!isDeleted) visibleIndex++;
        
        const d = item.data;
        const num = isDeleted ? '-' : '#' + visibleIndex;
        
        html += `<div class="article-item ${isDeleted ? 'deleted' : ''}">`;
        html += `<div class="article-header">`;
        html += `<span class="article-num">${num}</span>`;
        html += `<div class="article-actions">`;
        
        if (!deleteMode) {
          // æ­£å¸¸æ¨¡å¼ï¼šä¸Šç§»ã€ä¸‹ç§»ã€æ ‡è®°åˆ é™¤
          html += `<button class="btn-icon" onclick="moveUp('${type}', ${item.id})" title="ä¸Šç§»">â†‘</button>`;
          html += `<button class="btn-icon" onclick="moveDown('${type}', ${item.id})" title="ä¸‹ç§»">â†“</button>`;
          html += `<button class="btn-icon delete" onclick="toggleDelete('${type}', ${item.id})" title="æ ‡è®°åˆ é™¤">ğŸ—‘ï¸</button>`;
        } else {
          // åˆ é™¤æ¨¡å¼ï¼šæ’¤é”€ã€å½»åº•åˆ é™¤
          if (isDeleted) {
            html += `<button class="btn-icon restore" onclick="toggleDelete('${type}', ${item.id})" title="æ’¤é”€åˆ é™¤">â†©ï¸</button>`;
            html += `<button class="btn-icon delete" onclick="permanentDelete('${type}', ${item.id})" title="å½»åº•åˆ é™¤">âŒ</button>`;
          } else {
            html += `<button class="btn-icon delete" onclick="toggleDelete('${type}', ${item.id})" title="æ ‡è®°åˆ é™¤">ğŸ—‘ï¸</button>`;
          }
        }
        
        html += `</div></div>`;
        
        // è¡¨å•å­—æ®µ
        if (type === 'rss') {
          html += createField('æ ‡é¢˜', 'title', type, item.id, d.title);
          html += `<div class="form-row">`;
          html += createField('æ¥æº', 'source', type, item.id, d.source, true);
          html += createField('æ—¶é—´', 'time', type, item.id, d.time, true);
          html += `</div>`;
          html += createField('æ‘˜è¦', 'summary', type, item.id, d.summary, false, true);
          html += createField('é“¾æ¥', 'url', type, item.id, d.url);
        } else if (type === 'ai') {
          html += createField('æ ‡é¢˜', 'title', type, item.id, d.title);
          html += createField('æ¥æº', 'source', type, item.id, d.source, true);
          html += createField('æ‘˜è¦', 'summary', type, item.id, d.summary, false, true);
          html += createField('é“¾æ¥', 'url', type, item.id, d.url);
        } else if (type === 'thoughts') {
          html += createField('å†…å®¹', 'content', type, item.id, d.content, false, true);
          html += createField('æ—¶é—´', 'time', type, item.id, d.time, true);
        } else if (type === 'rec') {
          html += createField('æ ‡é¢˜', 'title', type, item.id, d.title);
          html += createField('æ¥æº', 'source', type, item.id, d.source, true);
          html += createField('æ‘˜è¦', 'summary', type, item.id, d.summary, false, true);
          html += createField('é“¾æ¥', 'url', type, item.id, d.url);
        }
        
        html += `</div>`;
      });
      
      container.innerHTML = html;
    }

    // åˆ›å»ºè¡¨å•å­—æ®µ
    function createField(label, field, type, id, value, small = false, textarea = false) {
      const input = textarea 
        ? `<textarea class="form-textarea" placeholder="${label}" onchange="updateItem('${type}', ${id}, '${field}', this.value)">${value || ''}</textarea>`
        : `<input type="text" class="form-input" placeholder="${label}" value="${value || ''}" onchange="updateItem('${type}', ${id}, '${field}', this.value)">`;
      
      return `<div class="form-group" ${small ? 'style="margin-bottom: 8px;"' : ''}>
        <label class="form-label">${label}</label>
        ${input}
      </div>`;
    }

    // æ›´æ–°ç»Ÿè®¡
    function updateStats() {
      let total = 0;
      let deleted = 0;
      
      ['rss', 'ai', 'thoughts', 'rec'].forEach(type => {
        const list = articles[type];
        const visible = list.filter(a => !a.deleted).length;
        const del = list.filter(a => a.deleted).length;
        document.getElementById('stat-' + type).textContent = visible;
        total += visible;
        deleted += del;
      });
      
      document.getElementById('stat-total').textContent = total;
      document.getElementById('stat-deleted').textContent = deleted;
    }

    // ä¿å­˜æ•°æ®
    function saveData() {
      const data = {
        dates,
        articles,
        timestamp: Date.now()
      };
      localStorage.setItem('dd_manager_data', JSON.stringify(data));
    }

    // åŠ è½½æ•°æ®
    function loadData() {
      const saved = localStorage.getItem('dd_manager_data');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          dates = data.dates || { zh: '', en: '' };
          articles = data.articles || { rss: [], ai: [], thoughts: [], rec: [] };
          // æ˜¾ç¤ºå·²ä¿å­˜çš„æ—¥æœŸ
          if (dates.zh) document.getElementById('date-zh').value = dates.zh;
          if (dates.en) document.getElementById('date-en').value = dates.en;
        } catch (e) {}
      }
    }

    // ç”Ÿæˆä»£ç ï¼ˆè‡ªåŠ¨æ’é™¤å·²åˆ é™¤çš„æ–‡ç« ï¼Œé‡æ–°ç¼–å·ï¼‰
    function generateCode() {
      const output = {
        date: dates.zh,
        dateEn: dates.en,
        rss: articles.rss.filter(a => !a.deleted).map(a => a.data),
        ai: articles.ai.filter(a => !a.deleted).map(a => a.data),
        thoughts: articles.thoughts.filter(a => !a.deleted).map(a => a.data),
        rec: articles.rec.filter(a => !a.deleted).map(a => a.data)
      };
      
      generatedCode = `const dailyContent = ${JSON.stringify(output, null, 2)};`;
      document.getElementById('codeOutput').textContent = generatedCode;
      document.getElementById('copyBtn').disabled = false;
      
      // æ»šåŠ¨åˆ°ä»£ç åŒºåŸŸ
      document.getElementById('codeOutput').scrollIntoView({ behavior: 'smooth' });
    }

    // å¤åˆ¶ä»£ç 
    function copyCode() {
      if (!generatedCode) return;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(generatedCode).then(() => {
          alert('âœ… ä»£ç å·²å¤åˆ¶ï¼\n\nç°åœ¨æŠŠä»£ç ç²˜è´´å‘ç»™åŠ©æ‰‹ï¼Œæˆ‘ä¼šå¸®ä½ æ›´æ–°ä¸»ç½‘ç«™ã€‚');
        });
      } else {
        const t = document.createElement('textarea');
        t.value = generatedCode;
        document.body.appendChild(t);
        t.select();
        document.execCommand('copy');
        document.body.removeChild(t);
        alert('âœ… ä»£ç å·²å¤åˆ¶ï¼\n\nç°åœ¨æŠŠä»£ç ç²˜è´´å‘ç»™åŠ©æ‰‹ï¼Œæˆ‘ä¼šå¸®ä½ æ›´æ–°ä¸»ç½‘ç«™ã€‚');
      }
    }
  </script>
</body>
</html>
