<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Digest - æ¯æ—¥ç²¾é€‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
  <link rel="stylesheet" href="./style.css">
  <style>
    /* AIæ‘˜è¦Tabæ ·å¼ */
    .ai-summary-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 8px;
    }
    .ai-tab {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.2s;
      background: #f3f4f6;
      color: #6b7280;
      border: none;
    }
    .ai-tab:hover {
      background: #e5e7eb;
    }
    .ai-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .ai-summary-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .ai-summary-content.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .expand-btn {
      color: #667eea;
      font-size: 0.9em;
      cursor: pointer;
      margin-top: 8px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .expand-btn:hover {
      text-decoration: underline;
    }
    .ai-summary-section {
      margin-top: 12px;
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
      display: none;
    }
    .ai-summary-section.expanded {
      display: block;
    }
    .loading-dots {
      display: inline-flex;
      gap: 4px;
    }
    .loading-dots span {
      width: 8px;
      height: 8px;
      background: #667eea;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }
    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }
    .bullet-point {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin: 6px 0;
      font-size: 0.9em;
    }
    .bullet-point::before {
      content: "â€¢";
      color: #667eea;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="nav-brand"><h1>Daily Digest</h1></div>
    <div class="nav-menu">
      <button class="nav-btn active" onclick="showSection('rss-articles')">RSSæ–‡ç« </button>
      <button class="nav-btn" onclick="showSection('ai-news')">AIçƒ­ç‚¹</button>
      <button class="nav-btn" onclick="showSection('recommendations')">ä¸ªäººæ¨è</button>
      <button class="nav-btn" onclick="showSection('archive')">å¾€æ—¥å›é¡¾</button>
      <button class="nav-btn" onclick="showSection('favorites')">æˆ‘çš„æ”¶è—</button>
    </div>
  </nav>

  <main class="container">
    <!-- AIçƒ­ç‚¹ -->
    <section class="section active" id="ai-news">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">AIçƒ­ç‚¹</span>
          <span class="panel-date">2026å¹´02æœˆ20æ—¥</span>
        </div>
        <div class="article-list">
          
          <!-- Top 1 -->
          <div class="article-card" style="position: relative;" data-article-id="gemini-31-pro">
            <div style="position: absolute; top: 15px; right: 15px; width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 0.85em; font-weight: bold;">87</div>
            <div class="article-title">Gemini 3.1 Pro</div>
            <div class="article-meta"><span class="article-source">simonwillison.net</span> <span class="article-date">21å°æ—¶å‰</span></div>
            <div class="article-summary">
              è°·æ­Œå‘å¸ƒGemini 3.1ç³»åˆ—é¦–ä¸ªæ¨¡å‹ï¼Œå®šä»·ä¸Gemini 3 Proç›¸åŒã€‚è¾“å…¥è¾“å‡ºæ¯ç™¾ä¸‡tokensä»·æ ¼åˆ†åˆ«ä¸º2ç¾å…ƒå’Œ12ç¾å…ƒã€‚
            </div>
            <div class="expand-btn" onclick="toggleAISummary('gemini-31-pro', this)">
              <span>ğŸ¤– AIæ™ºèƒ½æ‘˜è¦</span>
              <span class="arrow">â–¼</span>
            </div>
            <div class="ai-summary-section" id="ai-summary-gemini-31-pro">
              <div class="ai-summary-tabs">
                <button class="ai-tab active" onclick="switchTab('gemini-31-pro', 'quick')">âš¡ 30ç§’é€Ÿè¯»</button>
                <button class="ai-tab" onclick="switchTab('gemini-31-pro', 'standard')">ğŸ“„ æ ‡å‡†æ‘˜è¦</button>
                <button class="ai-tab" onclick="switchTab('gemini-31-pro', 'simple')">ğŸ‘¶ å°ç™½è§£é‡Š</button>
              </div>
              <div class="ai-summary-content active" id="tab-gemini-31-pro-quick">
                <div class="loading-dots" id="loading-gemini-31-pro-quick"><span></span><span></span><span></span></div>
              </div>
              <div class="ai-summary-content" id="tab-gemini-31-pro-standard">
                <div class="loading-dots" id="loading-gemini-31-pro-standard"><span></span><span></span><span></span></div>
              </div>
              <div class="ai-summary-content" id="tab-gemini-31-pro-simple">
                <div class="loading-dots" id="loading-gemini-31-pro-simple"><span></span><span></span><span></span></div>
              </div>
            </div>
          </div>

          <!-- Top 2 -->
          <div class="article-card" style="position: relative;" data-article-id="prompt-caching">
            <div style="position: absolute; top: 15px; right: 15px; width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 0.85em; font-weight: bold;">80</div>
            <div class="article-title">æç¤ºè¯ç¼“å­˜çš„å·¥ç¨‹å®è·µ</div>
            <div class="article-meta"><span class="article-source">simonwillison.net</span> <span class="article-date">8å°æ—¶å‰</span></div>
            <div class="article-summary">
              Thariq Shihiparå…³äºæç¤ºè¯ç¼“å­˜åœ¨é•¿å‘¨æœŸæ™ºèƒ½ä½“äº§å“ä¸­å…³é”®ä½œç”¨çš„è§‚ç‚¹ã€‚Claude Codeæ•´ä¸ªç³»ç»Ÿæ¶æ„éƒ½å›´ç»•æç¤ºè¯ç¼“å­˜æ„å»ºã€‚
            </div>
            <div class="expand-btn" onclick="toggleAISummary('prompt-caching', this)">
              <span>ğŸ¤– AIæ™ºèƒ½æ‘˜è¦</span>
              <span class="arrow">â–¼</span>
            </div>
            <div class="ai-summary-section" id="ai-summary-prompt-caching">
              <div class="ai-summary-tabs">
                <button class="ai-tab active" onclick="switchTab('prompt-caching', 'quick')">âš¡ 30ç§’é€Ÿè¯»</button>
                <button class="ai-tab" onclick="switchTab('prompt-caching', 'standard')">ğŸ“„ æ ‡å‡†æ‘˜è¦</button>
                <button class="ai-tab" onclick="switchTab('prompt-caching', 'simple')">ğŸ‘¶ å°ç™½è§£é‡Š</button>
              </div>
              <div class="ai-summary-content active" id="tab-prompt-caching-quick">
                <div class="loading-dots" id="loading-prompt-caching-quick"><span></span><span></span><span></span></div>
              </div>
              <div class="ai-summary-content" id="tab-prompt-caching-standard">
                <div class="loading-dots" id="loading-prompt-caching-standard"><span></span><span></span><span></span></div>
              </div>
              <div class="ai-summary-content" id="tab-prompt-caching-simple">
                <div class="loading-dots" id="loading-prompt-caching-simple"><span></span><span></span><span></span></div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>
  </main>

  <script>
    // APIé…ç½® - ä½¿ç”¨Kimi
    const API_CONFIG = {
      baseUrl: 'https://api.moonshot.cn/v1',
      apiKey: 'sk-kimi-SQf5VB45vPipIvInNMKkMKwZUd1QSgf59qEJWowTwBFxiz4wgRueoA0pJHKetqKw',
      model: 'kimi-k2p5'
    };

    // æœ¬åœ°ç¼“å­˜ç®¡ç†
    const SummaryCache = {
      get(articleId, type) {
        const key = `summary_${articleId}_${type}`;
        const cached = localStorage.getItem(key);
        if (cached) {
          const data = JSON.parse(cached);
          // ç¼“å­˜æœ‰æ•ˆæœŸ7å¤©
          if (Date.now() - data.timestamp < 7 * 24 * 60 * 60 * 1000) {
            return data.content;
          }
        }
        return null;
      },
      set(articleId, type, content) {
        const key = `summary_${articleId}_${type}`;
        localStorage.setItem(key, JSON.stringify({
          content,
          timestamp: Date.now()
        }));
      }
    };

    // å±•å¼€/æ”¶èµ·AIæ‘˜è¦
    function toggleAISummary(articleId, btn) {
      const section = document.getElementById(`ai-summary-${articleId}`);
      const arrow = btn.querySelector('.arrow');
      
      if (section.classList.contains('expanded')) {
        section.classList.remove('expanded');
        arrow.textContent = 'â–¼';
      } else {
        section.classList.add('expanded');
        arrow.textContent = 'â–²';
        // é¦–æ¬¡å±•å¼€æ—¶åŠ è½½æ•°æ®
        loadSummary(articleId, 'quick');
      }
    }

    // åˆ‡æ¢Tab
    function switchTab(articleId, type) {
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      const section = document.getElementById(`ai-summary-${articleId}`);
      section.querySelectorAll('.ai-tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      // æ›´æ–°å†…å®¹æ˜¾ç¤º
      section.querySelectorAll('.ai-summary-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`tab-${articleId}-${type}`).classList.add('active');
      
      // åŠ è½½å¯¹åº”ç±»å‹çš„æ‘˜è¦
      loadSummary(articleId, type);
    }

    // è°ƒç”¨APIç”Ÿæˆæ‘˜è¦
    async function generateSummary(articleId, type, content) {
      const prompts = {
        quick: `è¯·ç”¨ä¸€å¥è¯æ€»ç»“è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒå†…å®¹ï¼Œç„¶ååˆ—å‡º3ä¸ªå…³é”®è¦ç‚¹ã€‚æ ¼å¼ï¼š
ã€ä¸€å¥è¯ã€‘...
ã€è¦ç‚¹ã€‘
â€¢ ...
â€¢ ...
â€¢ ...

æ–‡ç« å†…å®¹ï¼š${content}`,
        
        standard: `è¯·å¯¹è¿™ç¯‡æ–‡ç« è¿›è¡Œæ ‡å‡†æ‘˜è¦ï¼ŒåŒ…æ‹¬ï¼š
1. æ ¸å¿ƒè§‚ç‚¹
2. ä¸»è¦è®ºæ®
3. å®é™…åº”ç”¨/å½±å“

è¯·ç”¨ç®€æ´ä¸“ä¸šçš„è¯­è¨€ï¼Œ200å­—å·¦å³ã€‚

æ–‡ç« å†…å®¹ï¼š${content}`,
        
        simple: `è¯·ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€è§£é‡Šè¿™ç¯‡æ–‡ç« ï¼Œå°±åƒç»™å®Œå…¨ä¸æ‡‚æŠ€æœ¯çš„äººè®²è§£ä¸€æ ·ã€‚é¿å…ä¸“ä¸šæœ¯è¯­ï¼Œç”¨ç±»æ¯”å’Œä¾‹å­å¸®åŠ©ç†è§£ã€‚

æ–‡ç« å†…å®¹ï¼š${content}`
      };

      try {
        const response = await fetch(`${API_CONFIG.baseUrl}/chat/completions`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_CONFIG.apiKey}`
          },
          body: JSON.stringify({
            model: API_CONFIG.model,
            messages: [
              { role: 'system', content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–°é—»æ‘˜è¦åŠ©æ‰‹ã€‚' },
              { role: 'user', content: prompts[type] }
            ],
            temperature: 0.7
          })
        });

        const data = await response.json();
        return data.choices[0].message.content;
      } catch (error) {
        console.error('APIè°ƒç”¨å¤±è´¥:', error);
        return 'ç”Ÿæˆæ‘˜è¦å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚';
      }
    }

    // åŠ è½½æ‘˜è¦
    async function loadSummary(articleId, type) {
      // æ£€æŸ¥ç¼“å­˜
      const cached = SummaryCache.get(articleId, type);
      const contentEl = document.getElementById(`tab-${articleId}-${type}`);
      
      if (cached) {
        contentEl.innerHTML = formatSummary(cached, type);
        return;
      }

      // è·å–æ–‡ç« å†…å®¹
      const card = document.querySelector(`[data-article-id="${articleId}"]`);
      const title = card.querySelector('.article-title').textContent;
      const summary = card.querySelector('.article-summary').textContent;
      const fullContent = `${title}\n\n${summary}`;

      // è°ƒç”¨APIç”Ÿæˆ
      const result = await generateSummary(articleId, type, fullContent);
      
      // ä¿å­˜åˆ°ç¼“å­˜
      SummaryCache.set(articleId, type, result);
      
      // æ˜¾ç¤ºç»“æœ
      contentEl.innerHTML = formatSummary(result, type);
    }

    // æ ¼å¼åŒ–æ‘˜è¦æ˜¾ç¤º
    function formatSummary(text, type) {
      if (type === 'quick') {
        // 30ç§’é€Ÿè¯»æ ¼å¼
        return text.replace(/ã€ä¸€å¥è¯ã€‘/g, '<div style="font-weight:bold;color:#667eea;margin-bottom:8px;">ğŸ’¡ ä¸€å¥è¯æ€»ç»“</div>')
                   .replace(/ã€è¦ç‚¹ã€‘/g, '<div style="font-weight:bold;color:#667eea;margin:12px 0 8px;">ğŸ“ å…³é”®è¦ç‚¹</div>')
                   .replace(/â€¢ /g, '<div class="bullet-point">')
                   .replace(/\n/g, '</div>');
      }
      return text.replace(/\n/g, '<br>');
    }

    // ç®€å•çš„ç‰ˆå—åˆ‡æ¢ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰
    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(id)?.classList.add('active');
      event.target.classList.add('active');
    }
  </script>
</body>
</html>
